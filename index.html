<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>領導行為分析問卷 (Google Sheets 版)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --brand-red: #A72C32;
            --brand-green: #00A65D;
            --brand-black: #231F20;
            --brand-white: #FFFFFF;
            --gray-100: #f8f9fa;
            --gray-200: #e9ecef;
            --gray-600: #6c757d;
            --gray-700: #495057;
        }
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            background-color: var(--gray-100);
            color: var(--brand-black);
        }
        .brand-text-red { color: var(--brand-red); }
        .brand-text-green { color: var(--brand-green); }
        .brand-bg-red { background-color: var(--brand-red); }
        .hover-bg-red-dark:hover { background-color: #8f252a; }
        .question-card {
            background-color: var(--brand-white);
            border-left-width: 4px;
            border-color: var(--brand-green);
        }
        .radio-custom:checked {
             background-image: url("data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3ccircle cx='8' cy='8' r='3'/%3e%3c/svg%3e");
             background-color: var(--brand-green);
             border-color: var(--brand-green);
        }
        .radio-custom:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        label:has(input:disabled) {
            cursor: not-allowed;
            background-color: #f9fafb;
        }
        .btn {
            font-weight: bold;
            padding: 0.75rem 2rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: all 0.3s ease-in-out;
        }
        .btn:disabled {
            background-color: #9ca3af;
            cursor: not-allowed;
            box-shadow: none;
        }
        .btn-green {
            background-color: var(--brand-green);
            color: white;
        }
        .btn-green:hover {
            background-color: #008a4a;
        }
    </style>
</head>
<body class="text-gray-800">

    <div id="welcome-page" class="min-h-screen flex items-center justify-center p-4">
        <div class="max-w-lg w-full bg-white p-8 rounded-xl shadow-lg text-center">
            <h1 class="text-3xl font-bold brand-text-red mb-2">領導行為分析 </h1>
            <p class="text-lg text-gray-600 mb-6">自我評量問卷</p>
            <div class="space-y-4 text-left">
                <div>
                    <h3 class="font-semibold text-gray-800 mb-2">個人資訊</h3>
                    <div>
                        <label for="employeeId" class="block text-sm font-medium text-gray-700 mb-1">員工編號</label>
                        <input type="text" id="employeeId" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500" placeholder="請輸入您的員工編號">
                    </div>
                    <div class="mt-4">
                        <label for="employeeName" class="block text-sm font-medium text-gray-700 mb-1">員工姓名</label>
                        <input type="text" id="employeeName" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500" placeholder="請輸入您的姓名">
                    </div>
                </div>
            </div>
            <div class="mt-8">
                <button id="startBtn" class="w-full brand-bg-red text-white font-bold py-3 px-8 rounded-lg shadow-lg hover-bg-red-dark focus:outline-none focus:ring-4 focus:ring-red-300 transition-all duration-300">
                    開始問卷
                </button>
            </div>
        </div>
    </div>

    <div id="questionnaire-page" class="hidden container mx-auto p-4 sm:p-6 md:p-8">
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold brand-text-red">領導行為分析 </h1>
            <p class="text-md sm:text-lg text-gray-600 mt-2">自我評量問卷</p>
        </header>
        <div id="questionnaire" class="space-y-6"></div>
        <div class="text-center mt-8 space-x-4">
            <button id="submitAndCalculateBtn" class="brand-bg-red text-white font-bold py-3 px-8 rounded-lg shadow-lg hover-bg-red-dark focus:outline-none focus:ring-4 focus:ring-red-300 transition-all duration-300 transform hover:-translate-y-1">
                提交並查看結果
            </button>
        </div>
    </div>

    <div id="results-page" class="hidden container mx-auto p-4 sm:p-6 md:p-8">
        <!-- Part 1: Score Results -->
        <div class="max-w-3xl mx-auto">
            <header class="text-center mb-8">
                <h1 class="text-3xl sm:text-4xl font-bold brand-text-red">您的領導力分析結果</h1>
                <p class="text-md sm:text-lg text-gray-600 mt-2">您的領導風格彈性與效能</p>
            </header>
            <div class="bg-white p-6 sm:p-8 rounded-xl shadow-lg">
                <div id="employee-info-display" class="mb-6 p-4 bg-green-50 border-l-4 border-green-500 rounded-r-lg"></div>
                <div id="score-chart-container" class="w-full h-auto flex justify-center items-center mb-8"></div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-center mb-8">
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h3 class="text-lg font-semibold brand-text-green">領導風格彈性</h3>
                        <p class="text-4xl font-bold brand-text-green" id="flexibilityScoreText">0%</p>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h3 class="text-lg font-semibold brand-text-red">領導風格效能</h3>
                        <p class="text-4xl font-bold brand-text-red" id="effectivenessScoreText">0%</p>
                    </div>
                </div>
                <div id="interpretation-section" class="mt-4 border-t pt-6">
                     <h2 class="text-2xl font-bold text-center mb-6" style="color: var(--brand-black);">詳細解讀</h2>
                     <div class="space-y-6">
                        <div id="flex-interpretation"></div>
                        <div id="effect-interpretation"></div>
                     </div>
                </div>
            </div>
        </div>

        <!-- Part 2: Answered Questions -->
        <div id="answered-questions-section" class="max-w-3xl mx-auto mt-12">
            <h2 class="text-3xl sm:text-4xl font-bold brand-text-red text-center mb-8 border-t pt-8">問卷回答記錄</h2>
            <div id="answered-questions-container" class="space-y-6">
                <!-- Answered questions will be injected here -->
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="text-center mt-12">
             <button id="retakeBtn" class="btn bg-gray-700 text-white hover:bg-gray-800">重新測驗</button>
        </div>
    </div>

    <div id="alert-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
            <div class="mt-3 text-center">
                <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-yellow-100">
                    <svg class="h-6 w-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
                </div>
                <h3 class="text-lg leading-6 font-medium text-gray-900 mt-2" id="alert-title">提醒</h3>
                <div class="mt-2 px-7 py-3">
                    <p class="text-sm text-gray-500" id="alert-message">請完成所有問題後再計算分數。</p>
                </div>
                <div class="items-center px-4 py-3">
                    <button id="close-modal-btn" class="px-4 py-2 brand-bg-red text-white text-base font-medium rounded-md w-full shadow-sm hover-bg-red-dark focus:outline-none focus:ring-2 focus:ring-red-300">
                        我知道了
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
    // ====================================================================================
    // --- START: CONFIGURATION PARAMETERS (可修改的參數設定區塊) ---
    // ====================================================================================

    // *** 請將您從 Google Apps Script 部署後取得的 URL 貼在下方引號中 ***
    const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxfUfZQ3zB98giRondmSaxMz-rj1tcXrxu_l11hscVbMOKfDLOQscV29BMPwVQOl8TS/exec";

    // 問卷題目內容
    const questions = [
        { id: 1, text: "您要求一位新進員工撰寫一份為部門採購新設備的提案。她需要深入了解這款設備，才能對各種選項和成本做出明智的決定。她覺得這項任務會讓她本已滿檔的行程更加緊湊。您會...", options: { A: "告訴她您希望何時收到提案，並說明提案中需要包含的內容。概述她應採取的步驟以熟悉新設備。設定每日會議來追蹤她的進度。", B: "要求她提出提案並討論其重要性。請她設定完成期限。提供她所需的資源。要求她定期提供進度報告。", C: "告訴她您希望何時收到提案並討論其重要性。說明報告中您想要看到的內容。概述她應採取的步驟以了解更多關於設備的資訊。聆聽她的擔憂，並盡可能採納她的想法。設定每週會議來追蹤她的進度。", D: "要求她提出提案並討論其重要性。探討她預見的障礙以及移除這些障礙的策略。請她設定完成期限，並定期與她確認以追蹤進度。" } },
        { id: 2, text: "您的專案小組一直在努力完成其部門級的報告。一位新成員加入了小組。他必須在下週末前提交成本數據，但他對報告的要求和格式一無所知。他渴望了解更多關於他在小組中的角色。您會...", options: { A: "明確告訴他需要什麼。具體說明要求和格式。將他介紹給其他專案小組成員。在一周內頻繁與他核對，以監控進度並指明修正之處。", B: "問他是否有任何您可以幫忙的地方。將他介紹給其他專案小組成員。探討他對於「快速上手」報告的想法。在一周內與他核對，看看他做得如何。", C: "具體說明報告格式和所需資訊，並徵求他的意見。將他介紹給每位專案小組成員。在一周內頻繁與他核對，看看報告進展如何，並協助進行任何修改。", D: "歡迎他並將他介紹給可以幫助他的專案小組成員。請他若有任何問題隨時回報。" } },
        { id: 3, text: "您最近注意到您的一位部屬出現了績效問題。他表現出「我不在乎」的態度。只有在您不斷催促下，任務才能完成。您懷疑他可能沒有足夠的專業知識來完成您交給他的這項高優先級任務。您會...", options: { A: "明確指出他需要採取的步驟和您想要的成果。闡明時間表和文書要求。頻繁檢查任務是否按計畫進行。", B: "明確指出他需要採取的步驟和您想要的成果。詢問他的想法，並在適當時納入。請他分享對這項任務的感受。檢查任務是否按計畫進行。", C: "讓他參與解決這項任務的問題。提供您的幫助，並鼓勵他運用自己的想法來完成專案。請他分享對這項任務的感受。定期查看進展情況。", D: "讓他知道這項任務有多重要。請他概述他的完成計畫，並寄一份副本給您。請他若有任何問題隨時回報。" } },
        { id: 4, text: "由於公司重組，您的工作小組組成發生了變化。績效水平下降，截止日期一再錯過，您的經理對此感到擔憂。小組成員希望提高績效，但需要更多的知識和技能。您會...", options: { A: "要求他們找出自己的培訓需求，並制定自己的績效改進計畫。給予他們必要的資源。隨時準備幫助他們，並要求被告知進度。", B: "討論您解決績效問題的計畫。徵求他們的意見，並在可能的情況下將他們的想法納入您的計畫中。解釋您的理由。頻繁檢查計畫的執行情況。", C: "概述您希望他們遵循的步驟來解決績效問題。具體說明時間要求和您希望他們學習的技能。密切監控他們計畫的進展。", D: "幫助他們制定一個提高績效的計畫。鼓勵他們發揮創意。支持他們的計畫，並定期檢查績效。" } },
        { id: 5, text: "由於預算削減，有必要進行整合。您已要求一位經驗豐富的部門成員負責整合工作。此人在您部門的各個領域都有工作經驗。過去她通常很樂意幫忙。雖然您覺得她有能力完成這項任務，但她似乎對此任務漠不關心。您會...", options: { A: "安撫她。概述她應用來管理此專案的步驟。徵求她的意見，並在可能的情況下納入，但要確保她遵循您的大致方法。頻繁檢查進展情況。", B: "安撫她。請她按她認為合適的方式處理這個專案。保持耐心並隨時準備提供幫助。要求頻繁的更新。", C: "安撫她。請她決定處理此專案的最佳方式。幫助她發展選項，並鼓勵她運用自己的想法。商定頻繁的檢查點。", D: "安撫她。概述一個總體計畫，並具體說明您希望她遵循的步驟。頻繁檢查這些步驟的執行情況。" } },
        { id: 6, text: "這是一個月內第二次，您與您的一位員工之間出現了問題。他的每週進度報告不完整且遲交。過去他都能準確完成報告並按時提交。這是您第一次就這個問題與他交談。您會...", options: { A: "告訴他要提高文書工作的品質和及時性。檢查不完整的部分。確保他知道期望是什麼，以及如何填寫報告的每個部分。繼續追蹤他的表現。", B: "請他提交完整且準時的報告，但不要催促他。繼續追蹤他的表現。", C: "與他討論時間和完成標準。聽取他的擔憂，但要讓他知道期望是什麼。檢查報告的每個部分並回答任何問題。如果可能，使用他的想法。繼續追蹤他的表現。", D: "問他為什麼報告不完整。聽取他的擔憂，並盡力幫助他理解及時準確報告的重要性。繼續追蹤他的表現。" } },
        { id: 7, text: "您要求您的一位資深員工負責一個新專案。過去他的表現非常出色。您交給他的這個專案對您工作小組的未來至關重要。他對新任務感到興奮，但因為缺乏專案資訊而不知從何開始。您會...", options: { A: "解釋為什麼您認為他有能力完成這項工作。問他預計會遇到什麼問題，並幫助他探索替代方案。經常與他保持聯繫以支持他。", B: "具體說明他應該如何處理這個專案。定義完成工作所需的活動。密切監控事情的進展。", C: "請他在兩週內制定一份專案計畫供您批准。給他足夠的時間開始。定期提供支持。", D: "概述專案應如何處理，並徵求他的想法和建議。在可能的情況下採納他的想法，但要確保遵循您的大致框架。定期檢查事情的進展。" } },
        { id: 8, text: "您的一位員工對您指派給他的一項工作感到沒有安全感。他能力很強，您也知道他有成功完成任務的技能。完成的截止日期即將到來。您會...", options: { A: "讓他知道您對即將到來的截止日期的擔憂。幫助他探索替代的行動步驟，並鼓勵他運用自己的想法。定期與他核對以提供支持。", B: "討論您對即將到來的截止日期的擔憂。為他制定一個行動計畫，並徵求他的反應。如果可能，納入他的修改意見，但要確保他遵循您的大致框架。定期與他核對事情的進展。", C: "概述您希望他遵循的步驟。具體說明按時完成任務的原因。密切監控他的進度。", D: "問他是否有任何問題，但讓他自己解決問題。在不施加壓力的情況下，提醒他即將到來的截止日期。請他回報最新進展。" } },
        { id: 9, text: "由於客戶群擴大，您的員工要求您考慮調整他們的工作時間表。他們提出的變更對您來說很有道理。成員們能力很強，合作無間。您會...", options: { A: "幫助他們探索替代的排程可能性。隨時準備促進他們的小組討論。支持他們制定的計畫。檢查他們如何實施時間表。", B: "自己設計工作時間表。解釋您設計背後的理由。聽取他們的反應，徵求他們的意見，並在可能的情況下採納他們的建議。檢查時間表是否被遵守。", C: "允許員工自行設定工作時間表。在您批准後讓他們實施計畫。稍後再回來檢查，確保新的時間表對他們來說運作良好。", D: "自己設計工作時間表。解釋時間表將如何运作並回答任何問題。頻繁檢查時間表是否被遵守。" } },
        { id: 10, text: "由於組織變革，您被指派了六位新員工，他們過去三個月的績效一直在下降。他們似乎不具備完成新工作所需的任務知識和技能，而且由於變革，他們的態度也變差了。在一次小組會議上，您會...", options: { A: "讓他們意識到他們三個月的績效趨勢。要求他們決定該怎麼做，並為實施他們的解決方案設定一個截止日期。在某個時間點檢查他們的進度。", B: "讓他們意識到他們三個月的績效趨勢。具體說明您希望他們遵循的行動步驟。給予他們關於如何提高績效的建設性回饋。密切監控他們的進度。", C: "讓他們意識到他們三個月的績效趨勢。概述您希望他們遵循的步驟，解釋原因，並尋求他們的回饋。在可能的情況下使用他們的想法，但要確保他們遵循您的大致方法。定期監控他們的進度。", D: "讓他們意識到他們三個月的績效趨勢。問他們為什麼績效下降。聽取他們的擔憂和想法。幫助他們創建自己的績效改進計畫。定期檢查他們的進度。" } },
        { id: 11, text: "您部門的一位成員在過去22個月裡有著優良的績效記錄。他對來年的挑戰感到興奮。預算和單位目標與去年相比沒有太大變化。在與他討論來年目標和行動計畫的會議上，您會...", options: { A: "請他提交一份目標大綱和行動計畫供您批准。告訴他如果您有任何問題會打電話給他。", B: "準備一份您認為他明年可以完成的目標和行動計畫清單。寄給他並與他會面，看看他是否有任何問題。", C: "準備一份您認為他明年可以達成的目標和行動計畫清單。與他會面討論他的反應和建議。在聽取他的想法時修改計畫，但由您做最終決定。", D: "請他寄一份來年的目標大綱和行動計畫給您。與他一起審查目標和計畫。聽取他的想法並幫助他探索替代方案。讓他對自己的目標和計畫做出最終決定。" } },
        { id: 12, text: "您的單位成員在過去兩年中有著卓越的績效記錄。然而，由於超出他們控制範圍的因素，他們最近經歷了三次重大挫折。他們的績效和士氣急劇下降，您的經理對此感到擔憂。在一次小組會議上，您會...", options: { A: "討論最近的挫折。給予單位成員您希望他們遵循的具體步驟以提高績效。密切監控績效。", B: "問他們對最近的挫折有何感受。聽取他們的擔憂，並鼓勵和幫助他們探索提高績效的想法。定期檢查績效。", C: "討論最近的挫折。闡明您希望單位成員採取的步驟以提高績效。聽取他們的想法，並在可能的情況下納入。強調結果。鼓勵他們繼續努力。頻繁檢查他們的績效。", D: "在不給單位成員壓力的情況下討論最近的挫折。要求他們設定一個提高績效的截止日期，並在此過程中互相支持。繼續追蹤績效。" } },
        { id: 13, text: "您最近被指派了一位新員工，她將在您的單位擔任一項重要工作。儘管她沒有經驗，但她充滿熱情，並覺得自己有信心完成這項工作。您會...", options: { A: "給她時間來確定工作需要什麼以及如何去做。讓她知道這份工作的重要性。請她如果需要幫助就聯繫您。追蹤她的績效。", B: "具體說明您想要的結果以及何時想要。明確定義她為達成結果應採取的步驟。向她示範如何做這份工作。密切監控她的進度。", C: "討論您想要的結果以及何時想要。明確定義她可以為達成結果採取的步驟。解釋為什麼這些步驟是必要的，並徵求她的意見。如果可能，使用她的想法，但要確保遵循您的大致計畫。頻繁檢查她的進度。", D: "問她打算如何處理這份工作。幫助她探索她預期的問題，並產生可能的解決方案。鼓勵她執行她的計畫。隨時準備聽取她的擔憂。定期檢查她的進度。" } },
        { id: 14, text: "您的經理要求您將單位的產出提高百分之七。您知道這可以做到，但需要您的積極參與。為了騰出時間，您必須將開發新成本控制系統的任務重新分配給您的一位員工。您想要的人選在成本控制系統方面有相當豐富的經驗，但她對獨自完成這項任務有些不確定。您會...", options: { A: "將任務指派給她並聽取她的擔憂。解釋為什麼您認為她有能力處理這項任務。如果她認為有幫助，幫助她探索替代方法。通過提供所需資源來鼓勵和支持她。定期監控她的進度。", B: "將任務指派給她並聽取她的擔憂。討論完成任務的步驟。徵求她的想法和建議。在可能的情況下納入她的想法後，確保她遵循您的大致方法。頻繁監控她的進度。", C: "將任務指派給她。聽取她的擔憂，但讓她自己解決問題。給她時間適應，並避免立即要求結果。請她頻繁回報。", D: "將任務指派給她。聽取她的擔憂，並通過具體告訴她如何處理這項任務來減少她的不安全感。概述要採取的步驟。密切監控她的進度。" } },
        { id: 15, text: "您的經理要求您指派某人參加一個全公司範圍的專案小組。這個小組將就重組公司的薪酬計畫提出建議。您有一位高效率的員工，她知道她的同事對現有薪酬計畫的感受。她曾成功領導過另一個單位專案小組。她想要這個任務。您會...", options: { A: "給她這個任務，但告訴她應該如何呈現她同事的觀點。指定她在每次專案小組會議後的兩天內提交一份進度報告。", B: "請她接受這個任務。幫助她建立她在專案小組中將採取的觀點。定期與她核對。", C: "給她這個任務。討論她應該做些什麼來確保她同事的觀點被專案小組考慮。徵求她的意見，但要確保她遵循您的大致方法。要求她在每次專案小組會議後提交報告。", D: "給她這個任務。請她在事情進展時向您更新。" } },
        { id: 16, text: "由於家中有人生病，您被迫錯過了兩次由您指導的委員會會議。在參加下一次會議時，您發現委員會運作良好，並在完成其目標方面取得了進展。所有小組成員都準備充分，積極參與，並對他們的進展充滿熱情。您不確定自己的角色應該是什麼。您會...", options: { A: "感謝委員會成員迄今為止的工作。讓小組繼續像過去兩次會議那樣運作。", B: "感謝委員會成員迄今為止的工作。設定下次會議的議程。開始指導小組的活動。", C: "感謝委員會成員迄今為止的工作。嘗試徵求替代的想法和建議。盡您所能讓成員感到重要和參與。", D: "感謝委員會成員迄今為止的工作。設定下次會議的議程，但要確保徵求他們的想法和建議。" } },
        { id: 17, text: "您的員工非常有能力，並且能很好地獨立工作。由於最近的成功，他們的熱情很高。他們作為一個團隊的表現非常出色。現在，您必須為來年設定單位目標。在一次小組會議上，您會...", options: { A: "讚揚他們去年的成果。讓小組參與來年的問題解決和目標設定。鼓勵他們發揮創意並幫助他們探索替代方案。", B: "讚揚他們去年的成果。通過設定來年的目標來挑戰他們。概述達成這些目標所需的行動步驟。", C: "讚揚他們去年的成果。要求他們設定來年的目標，並定義他們達成這些目標的行動計畫。在被要求時隨時準備做出貢-獻。", D: "讚揚他們去年的成果。設定來年的目標，並概述達成這些目標所需的行動步驟。徵求小組的意見和建議，並在可能的情況下納入。" } },
        { id: 18, text: "您和您的經理都知道，您的部門需要一套新的工作程序來提高長期績效。部門成員渴望做出一些改變；但由於他們職能的專業化，他們缺乏理解「大局」的知識和技能。您會...", options: { A: "概述新程序和您的實施計畫。讓小組參與討論替代方案。在可能的情況下使用他們的建議，但要讓他們遵循您的大致方法。頻繁檢查新程序的使用情況並監控其結果。", B: "概述並示範新程序。指導小組初步使用程序，並密切監控結果。", C: "讓小組參與討論以探索新的工作程序。鼓勵他們在開發新程序中的主動性和創造力。幫助他們檢視可能的替代方案。定期檢查新程序的使用情況並監控他們的績效。", D: "要求小組制定並實施一套新的程序。回答任何資訊方面的問題，但將任務的責任交給部門成員。定期監控他們的績效。" } },
        { id: 19, text: "您最近被任命為您部門的主管。上任以來，您注意到績效下降。技術發生了變化，您的員工尚未掌握新的技能和技巧。最糟糕的是，他們似乎沒有動力去學習這些技能。在一次小組會議上，您會...", options: { A: "討論員工績效下降的問題。聽取他們的擔憂。徵求他們提高績效的解決方案。表達您對他們策略的信心。強調他們過去的努力，但在他們執行策略時定期檢查績效。", B: "概述您希望他們採取的必要糾正措施。探索替代方案並納入他們的想法。如果適當，修改計畫，但要確保他們實施。頻繁檢查他們的績效。", C: "告訴他們績效下降的情況。要求他們分析問題並起草一套行動步驟供您批准。為計畫設定一個截止日期。追蹤他們的績效。", D: "概述並指導您希望他們採取的必要糾正措施。定義角色、責任和標準。密切監控他們的績效以求改進。" } },
        { id: 20, text: "您注意到您的一位沒有經驗的員工沒有正確完成某些報告。這些報告不準確且不完整。她對這項任務不熱心，並常常認為文書工作是浪費時間。您會...", options: { A: "讓她知道她提交的報告不準確和不完整。討論她應採取的步驟，並闡明為什麼這些步驟很重要。徵求她的建議，但要確保她遵循您的大致框架。頻繁檢查她的文書工作。", B: "讓她知道她提交的報告不準確和不完整。要求她提出一個計畫來提高其品質。給她更多時間來妥善完成工作。檢查她的文書工作。", C: "讓她知道她提交的報告不準確和不完整。問她打算怎麼辦。幫助她制定一個解決問題的計畫。定期檢查她的文書工作。", D: "讓她知道她提交的報告不準確和不完整。向她展示如何完成報告。具體說明她為提高品質應採取的步驟。密切監控她的文書工作。" } }
    ];

    // 領導風格彈性計分規則
    const flexibilityMapping = [
        { A: 'S1', B: 'S4', C: 'S2', D: 'S3' }, { A: 'S1', B: 'S3', C: 'S2', D: 'S4' },
        { A: 'S1', B: 'S2', C: 'S3', D: 'S4' }, { A: 'S4', B: 'S2', C: 'S1', D: 'S3' },
        { A: 'S2', B: 'S4', C: 'S3', D: 'S1' }, { A: 'S1', B: 'S4', C: 'S2', D: 'S3' },
        { A: 'S3', B: 'S1', C: 'S4', D: 'S2' }, { A: 'S3', B: 'S2', C: 'S1', D: 'S4' },
        { A: 'S3', B: 'S2', C: 'S4', D: 'S1' }, { A: 'S4', B: 'S1', C: 'S2', D: 'S3' },
        { A: 'S4', B: 'S1', C: 'S2', D: 'S3' }, { A: 'S1', B: 'S3', C: 'S2', D: 'S4' },
        { A: 'S4', B: 'S1', C: 'S2', D: 'S3' }, { A: 'S3', B: 'S2', C: 'S4', D: 'S1' },
        { A: 'S1', B: 'S3', C: 'S2', D: 'S4' }, { A: 'S4', B: 'S1', C: 'S3', D: 'S2' },
        { A: 'S3', B: 'S1', C: 'S4', D: 'S2' }, { A: 'S2', B: 'S1', C: 'S3', D: 'S4' },
        { A: 'S3', B: 'S2', C: 'S4', D: 'S1' }, { A: 'S2', B: 'S4', C: 'S3', D: 'S1' }
    ];

    // 領導風格效能計分規則
    const effectivenessMapping = [
        { A: 3, B: 1, C: 4, D: 1 }, { A: 4, B: 1, C: 3, D: 1 },
        { A: 3, B: 4, C: 1, D: 1 }, { A: 1, B: 3, C: 4, D: 1 },
        { A: 3, B: 1, C: 4, D: 1 }, { A: 1, B: 3, C: 1, D: 4 },
        { A: 1, B: 4, C: 1, D: 3 }, { A: 4, B: 1, C: 1, D: 3 },
        { A: 3, B: 1, C: 4, D: 1 }, { A: 1, B: 1, C: 4, D: 3 },
        { A: 4, B: 1, C: 1, D: 3 }, { A: 1, B: 4, C: 1, D: 3 },
        { A: 1, B: 4, C: 3, D: 1 }, { A: 4, B: 1, C: 3, D: 1 },
        { A: 1, B: 3, C: 1, D: 4 }, { A: 4, B: 1, C: 3, D: 1 },
        { A: 3, B: 1, C: 4, D: 1 }, { A: 3, B: 4, C: 1, D: 1 },
        { A: 1, B: 4, C: 1, D: 3 }, { A: 4, B: 1, C: 1, D: 3 }
    ];

    // ====================================================================================
    // --- END: CONFIGURATION PARAMETERS (設定區塊結束) ---
    // ====================================================================================


    document.addEventListener('DOMContentLoaded', () => {
        // App State
        let reportData = null; 

        // DOM Elements
        const welcomePage = document.getElementById('welcome-page');
        const questionnairePage = document.getElementById('questionnaire-page');
        const resultsPage = document.getElementById('results-page');
        
        const startBtn = document.getElementById('startBtn');
        const submitAndCalculateBtn = document.getElementById('submitAndCalculateBtn');
        const retakeBtn = document.getElementById('retakeBtn');
        
        const employeeIdInput = document.getElementById('employeeId');
        const employeeNameInput = document.getElementById('employeeName');
        const employeeInfoDisplay = document.getElementById('employee-info-display');

        const questionnaireContainer = document.getElementById('questionnaire');
        
        const modal = document.getElementById('alert-modal');
        const closeModalBtn = document.getElementById('close-modal-btn');
        const alertTitle = document.getElementById('alert-title');
        const alertMessage = document.getElementById('alert-message');

        function showAlert(title, message) {
            alertTitle.textContent = title;
            alertMessage.textContent = message;
            modal.classList.remove('hidden');
        }

        function showPage(page) {
            welcomePage.classList.add('hidden');
            questionnairePage.classList.add('hidden');
            resultsPage.classList.add('hidden');
            page.classList.remove('hidden');
            window.scrollTo(0, 0);
        }

        function renderQuestions() {
            questionnaireContainer.innerHTML = questions.map(q => `
                <div class="question-card p-6 rounded-lg shadow-md">
                    <p class="font-semibold text-lg mb-1" style="color: var(--brand-black);">問題 ${q.id}</p>
                    <p class="text-gray-700 mb-4">${q.text}</p>
                    <div class="space-y-3">
                        ${Object.entries(q.options).map(([key, value]) => `
                            <label for="q${q.id}_${key}" class="flex items-start p-3 rounded-md border border-gray-200 hover:bg-green-50 cursor-pointer transition-colors">
                                <input type="radio" id="q${q.id}_${key}" name="q${q.id}" value="${key}" class="radio-custom mt-1 h-4 w-4 border-gray-300">
                                <span class="ml-3 text-sm text-gray-600">${key}. ${value}</span>
                            </label>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }
        
        function renderAnsweredQuestions(answers) {
            const container = document.getElementById('answered-questions-container');
            container.innerHTML = questions.map(q => {
                const userAnswer = answers[q.id];
                return `
                    <div class="question-card p-6 rounded-lg shadow-md">
                        <p class="font-semibold text-lg mb-1" style="color: var(--brand-black);">問題 ${q.id}</p>
                        <p class="text-gray-700 mb-4">${q.text}</p>
                        <div class="space-y-3">
                            ${Object.entries(q.options).map(([key, value]) => `
                                <label class="flex items-start p-3 rounded-md border ${userAnswer === key ? 'bg-green-100 border-green-400' : 'border-gray-200'}">
                                    <input type="radio" name="q${q.id}_report" value="${key}" class="radio-custom mt-1 h-4 w-4 border-gray-300"
                                    ${userAnswer === key ? 'checked' : ''} disabled>
                                    <span class="ml-3 text-sm text-gray-600">${key}. ${value}</span>
                                </label>
                            `).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }


        function renderResultsPage(state) {
            const { employeeId, employeeName, results, answers } = state;
            if (!results) return;

            // Render score section
            employeeInfoDisplay.innerHTML = `
                <p class="text-md"><span class="font-semibold">員工編號:</span> ${employeeId}</p>
                <p class="text-md"><span class="font-semibold">員工姓名:</span> ${employeeName}</p>
            `;
            document.getElementById('flexibilityScoreText').textContent = `${results.flexibilityPercent}%`;
            document.getElementById('effectivenessScoreText').textContent = `${results.effectivenessPercent}%`;
            
            drawChart(results.flexibilityPercent, results.effectivenessPercent);
            renderInterpretation(results.flexibilityRawScore, results.effectivenessRawScore);

            // Render answered questions section
            renderAnsweredQuestions(answers);
            
            showPage(resultsPage);
        }
        
        async function handleSubmitAndCalculate() {
            const answers = {};
            const allAnswered = questions.every(q => {
                const selected = document.querySelector(`input[name="q${q.id}"]:checked`);
                if (selected) {
                    answers[q.id] = selected.value;
                    return true;
                }
                return false;
            });

            if (!allAnswered) {
                showAlert('提醒', '請完成所有問題後再提交。');
                return;
            }
            
            submitAndCalculateBtn.disabled = true;
            submitAndCalculateBtn.textContent = '正在提交...';

            // Calculate scores first
            const styleCounts = { S1: 0, S2: 0, S3: 0, S4: 0 };
            flexibilityMapping.forEach((mapping, i) => {
                const answer = answers[i + 1];
                const style = mapping[answer];
                if (style) styleCounts[style]++;
            });
            const subtotal = Object.values(styleCounts).reduce((acc, count) => acc + Math.abs(count - 5), 0);
            const flexibilityRawScore = 30 - subtotal;
            const flexibilityPercent = Math.round((flexibilityRawScore / 30) * 100);

            let effectivenessRawScore = 0;
            effectivenessMapping.forEach((mapping, i) => {
                const answer = answers[i + 1];
                effectivenessRawScore += mapping[answer];
            });
            const effectivenessPercent = Math.round(((effectivenessRawScore - 20) / 60) * 100);
            
            const submissionData = {
                EmployeeID: employeeIdInput.value.trim(),
                EmployeeName: employeeNameInput.value.trim(),
                FlexibilityScore: flexibilityPercent,
                EffectivenessScore: effectivenessPercent,
                FlexibilityRaw: flexibilityRawScore,
                EffectivenessRaw: effectivenessRawScore,
                AnswersJSON: JSON.stringify(answers)
            };

            // Try to save to Google Sheets
            const success = await saveToGoogleSheets(submissionData);

            if (success) {
                // Submission successful, now prepare data for the results page
                reportData = {
                    employeeId: submissionData.EmployeeID,
                    employeeName: submissionData.EmployeeName,
                    answers: answers,
                    results: { 
                        flexibilityPercent, 
                        effectivenessPercent, 
                        flexibilityRawScore, 
                        effectivenessRawScore 
                    }
                };
                renderResultsPage(reportData);
            } else {
                // Submission failed, button is re-enabled in saveToGoogleSheets
                // User stays on the questionnaire page
            }
        }
        
        async function saveToGoogleSheets(payload) {
            if (!GOOGLE_SCRIPT_URL || GOOGLE_SCRIPT_URL.includes("...")) {
                showAlert('設定錯誤', '問卷尚未設定完成。請管理員在 HTML 檔案中填入正確的 GOOGLE_SCRIPT_URL。');
                submitAndCalculateBtn.disabled = false;
                submitAndCalculateBtn.textContent = '提交並查看結果';
                return false;
            }

            try {
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'cors',
                    cache: 'no-cache',
                    redirect: 'follow',
                    body: JSON.stringify(payload),
                    headers: {
                        'Content-Type': 'text/plain;charset=utf-8',
                    }
                });

                if (response.ok) {
                     const result = await response.json();
                     if (result.result === 'success') {
                        return true; // Indicate success
                     } else {
                        throw new Error(result.message || 'Script returned an unknown error.');
                     }
                } else {
                    throw new Error(`伺服器錯誤: ${response.status} ${response.statusText}`);
                }

            } catch (error) {
                console.error('Google Sheets 提交錯誤:', error);
                showAlert('提交失敗', `無法將結果儲存到資料庫: ${error.message}. 請檢查您的網路連線或聯絡管理員。`);
                submitAndCalculateBtn.disabled = false;
                submitAndCalculateBtn.textContent = '提交並查看結果';
                return false; // Indicate failure
            }
        }

        function renderInterpretation(flexRaw, effectRaw) {
            const getFlexInterpretation = (score) => {
                if (score > 20) return { level: '高彈性', color: 'text-green-600', desc: '您傾向於平均地使用所有四種風格。' };
                if (score < 14) return { level: '低彈性', color: 'text-yellow-600', desc: '您傾向於在所有情境中使用相同的一或兩種風格。' };
                return { level: '中等彈性', color: 'text-blue-600', desc: '您在運用不同領導風格方面具備一定的彈性。' };
            };
            const getEffectInterpretation = (score) => {
                if (score > 58) return { level: '高效能', color: 'text-red-600', desc: '與他人相比，您選擇了較多「良好」與「極佳」的領導風格。' };
                if (score < 50) return { level: '低效能', color: 'text-yellow-600', desc: '與他人相比，您選擇了較多「尚可」與「不佳」的領導風格。' };
                return { level: '中等效能', color: 'text-blue-600', desc: '您在選擇合適領導風格方面的表現處於平均水平。' };
            };
            const flexData = getFlexInterpretation(flexRaw);
            const effectData = getEffectInterpretation(effectRaw);
            document.getElementById('flex-interpretation').innerHTML = `<div class="bg-gray-50 p-4 rounded-lg"><h4 class="font-semibold text-lg brand-text-green mb-2">領導風格彈性 (${flexRaw}/30)</h4><p class="text-md font-medium ${flexData.color} mb-2">您的水平: ${flexData.level}</p><p class="text-sm text-gray-700">${flexData.desc}</p></div>`;
            document.getElementById('effect-interpretation').innerHTML = `<div class="bg-gray-50 p-4 rounded-lg"><h4 class="font-semibold text-lg brand-text-red mb-2">領導風格效能 (${effectRaw}/80)</h4><p class="text-md font-medium ${effectData.color} mb-2">您的水平: ${effectData.level}</p><p class="text-sm text-gray-700">${effectData.desc} 要獲得高效能分數，您不僅需要展現高度的彈性，還必須為特定情境選擇最恰當的領導風格。</p></div>`;
        }
        function drawChart(flexPercent, effectPercent) {
            const container = document.getElementById('score-chart-container');
            container.innerHTML = '';
            const size = Math.min(container.clientWidth > 0 ? container.clientWidth : 300, 400);
            const strokeWidth = 30;
            const center = size / 2;
            const radius = (size / 2) - strokeWidth - 15;
            const polarToCartesian = (cx, cy, r, angleInDegrees) => {
                const angleInRadians = (angleInDegrees - 90) * Math.PI / 180.0;
                return { x: cx + (r * Math.cos(angleInRadians)), y: cy + (r * Math.sin(angleInRadians)) };
            };
            const describeArc = (x, y, r, startAngle, endAngle) => {
                const start = polarToCartesian(x, y, r, startAngle);
                const end = polarToCartesian(x, y, r, endAngle);
                const largeArcFlag = Math.abs(endAngle - startAngle) <= 180 ? "0" : "1";
                const sweepFlag = endAngle > startAngle ? 1 : 0;
                return `M ${start.x} ${start.y} A ${r} ${r} 0 ${largeArcFlag} ${sweepFlag} ${end.x} ${end.y}`;
            };
            const flexEndAngle = 180 + (flexPercent / 100) * 180;
            const effectEndAngle = 180 - (effectPercent / 100) * 180;
            const flexLabels = [{ text: '低', angle: 210, color: 'var(--brand-green)'}, { text: '中', angle: 270, color: 'var(--brand-green)' }, { text: '高', angle: 330, color: 'var(--brand-green)' }];
            const effectLabels = [{ text: '低', angle: 150, color: 'var(--brand-red)' }, { text: '中', angle: 90, color: 'var(--brand-red)' }, { text: '高', angle: 30, color: 'var(--brand-red)' }];
            const labelRadius = radius + strokeWidth;
            const labelsHtml = [...flexLabels, ...effectLabels].map(label => {
                const pos = polarToCartesian(center, center, labelRadius, label.angle);
                return `<text x="${pos.x}" y="${pos.y}" fill="${label.color}" font-size="14" font-weight="bold" text-anchor="middle" dominant-baseline="middle">${label.text}</text>`;
            }).join('');
            container.innerHTML = `<svg width="${size}" height="${size}" viewBox="0 0 ${size} ${size}"><path d="${describeArc(center, center, radius, 0, 359.99)}" fill="none" stroke="#e9ecef" stroke-width="${strokeWidth}" /><path id="flex-arc" fill="none" stroke="var(--brand-green)" stroke-width="${strokeWidth}" stroke-linecap="round"/><path id="effect-arc" fill="none" stroke="var(--brand-red)" stroke-width="${strokeWidth}" stroke-linecap="round"/><circle cx="${center}" cy="${center}" r="${radius - strokeWidth/2 - 5}" fill="var(--brand-white)" /><circle cx="${center}" cy="${center}" r="${radius - strokeWidth/2 - 10}" fill="var(--gray-100)" /><g id="flex-pointer" style="transform-origin: ${center}px ${center}px; transform: rotate(180deg);"><line x1="${center}" y1="${center}" x2="${center}" y2="${strokeWidth + 5}" stroke="var(--brand-green)" stroke-width="4" stroke-linecap="round" /></g><g id="effect-pointer" style="transform-origin: ${center}px ${center}px; transform: rotate(180deg);"><line x1="${center}" y1="${center}" x2="${center}" y2="${strokeWidth + 5}" stroke="var(--brand-red)" stroke-width="4" stroke-linecap="round" /></g>${labelsHtml}</svg>`;
            const flexArcEl = document.getElementById('flex-arc');
            const effectArcEl = document.getElementById('effect-arc');
            const flexPointerEl = document.getElementById('flex-pointer');
            const effectPointerEl = document.getElementById('effect-pointer');
            const duration = 1500;
            let startTime = null;
            function animationStep(timestamp) {
                if (!startTime) startTime = timestamp;
                const progress = Math.min((timestamp - startTime) / duration, 1);
                const currentFlexAngle = 180 + (flexEndAngle - 180) * progress;
                flexArcEl.setAttribute('d', describeArc(center, center, radius, 180, currentFlexAngle));
                flexPointerEl.style.transform = `rotate(${currentFlexAngle}deg)`;
                const currentEffectAngle = 180 - (180 - effectEndAngle) * progress;
                effectArcEl.setAttribute('d', describeArc(center, center, radius, currentEffectAngle, 180));
                effectPointerEl.style.transform = `rotate(${currentEffectAngle}deg)`;
                if (progress < 1) requestAnimationFrame(animationStep);
            }
            requestAnimationFrame(animationStep);
        }

        async function handleStart() {
            const employeeId = employeeIdInput.value.trim();
            const employeeName = employeeNameInput.value.trim();
            
            if (!employeeId || !employeeName) {
                showAlert('提醒', '員工編號和姓名為必填項。');
                return;
            }

            if (!GOOGLE_SCRIPT_URL || GOOGLE_SCRIPT_URL.includes("...")) {
                showAlert('設定錯誤', '問卷尚未設定完成。請管理員在 HTML 檔案中填入正確的 GOOGLE_SCRIPT_URL。');
                return;
            }
            
            startBtn.disabled = true;
            startBtn.textContent = '正在測試連線...';

            try {
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'GET',
                    headers: { 'Accept': 'application/json' }
                });

                if (response.ok) {
                    const data = await response.json();
                    if (data.status === 'success') {
                        renderQuestions();
                        showPage(questionnairePage);
                    } else {
                        throw new Error('Script did not return success status.');
                    }
                } else {
                    throw new Error(`伺服器錯誤，狀態碼: ${response.status}`);
                }
            } catch (error) {
                console.error('Google Script 連線測試失敗:', error);
                showAlert('連線失敗', `無法連接到後端資料庫: ${error.message}. 請確認 GOOGLE_SCRIPT_URL 是否正確，以及 Apps Script 是否已正確部署。`);
                startBtn.disabled = false;
                startBtn.textContent = '開始問卷';
            }
        }

        function resetQuiz() {
            reportData = null;
            employeeIdInput.value = '';
            employeeNameInput.value = '';
            questionnaireContainer.innerHTML = '';
            employeeInfoDisplay.innerHTML = '';
            document.getElementById('score-chart-container').innerHTML = '';
            document.getElementById('answered-questions-container').innerHTML = '';
            document.getElementById('flex-interpretation').innerHTML = '';
            document.getElementById('effect-interpretation').innerHTML = '';
            document.getElementById('flexibilityScoreText').textContent = '0%';
            document.getElementById('effectivenessScoreText').textContent = '0%';
            startBtn.disabled = false;
            startBtn.textContent = '開始問卷';
            submitAndCalculateBtn.disabled = false;
            submitAndCalculateBtn.textContent = '提交並查看結果';
            showPage(welcomePage);
        }

        function init() {
            showPage(welcomePage);
            startBtn.addEventListener('click', handleStart);
            submitAndCalculateBtn.addEventListener('click', handleSubmitAndCalculate);
            retakeBtn.addEventListener('click', resetQuiz);
            closeModalBtn.addEventListener('click', () => modal.classList.add('hidden'));
        }
        
        init();
    });
    </script>

</body>
</html>
